{"name":"Cycle Charge","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"modules/vyk-homebrew/assets/chargeBladeKnight/charge2.png","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.charge-blade-knight.ZIG2AEGFAGyha6JD\";\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n\n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let charge = existing.data.data.level.value;\n            \n\n            if(charge+1 > 3){\n                await existing.delete();\n                return;\n            }\n            \n            await existing.delete();\n            \n            source.data.level.value = charge+1;\n            source.img = `modules/vyk-homebrew/assets/chargeBladeKnight/charge${charge+1}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            \n            source.img = `modules/vyk-homebrew/assets/chargeBladeKnight/charge1.png`;\n            source.data.level.value = 1;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.QaS1jfvpZJlOPPK6"}},"_id":"cnIDd4gsvTA8a6wT"}
