{"name":"Substract Shard","type":"script","author":"KPVkkpR21c13yy2y","img":"modules/vyk-homebrew/assets/chrono/substract.png","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.chronomancer.hwBMfeUIZxCO49B0\";\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n\n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let motes = existing.data.data.level.value;\n            \n            await existing.delete();\n           \n            if(motes-1 === 0) return;\n            \n            source.data.level.value = motes-1;\n            source.img = `modules/vyk-homebrew/assets/chrono/motes${Math.min(9,motes-1)}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            ui.notifications.warn(\"You do not have any Time Motes left!\");\n            return;\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3,"KPVkkpR21c13yy2y":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.2vYeNq5TtEZNT6mf"}},"_id":"6VmkbD4FQFcyYnLj"}
{"name":"Reset Motes","type":"script","author":"KPVkkpR21c13yy2y","img":"modules/vyk-homebrew/assets/chrono/base.png","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.chronomancer.hwBMfeUIZxCO49B0\";\n\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let int = actor.data.data.abilities.int.mod;\n        \n        let watch = actor.getRollOptions(['all']).includes(\"feature:pocket-watch\");\n        \n        let cap = int + (watch?1:0);\n        \n        \n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            await existing.delete();\n        }\n            \n        source.img = `modules/vyk-homebrew/assets/chrono/motes${Math.min(9,Math.max(1,cap))}.png`;\n        source.data.level.value = Math.max(1,cap);\n        \n        await actor.createEmbeddedDocuments('Item', [source]);\n        \n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3,"KPVkkpR21c13yy2y":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.BgstaNrT1d3mqtbP"}},"_id":"J2P5IqBnYfMpVlO3"}
{"$$deleted":true,"_id":"J2P5IqBnYfMpVlO3"}
{"$$deleted":true,"_id":"6VmkbD4FQFcyYnLj"}
{"name":"Looping Spell","type":"script","scope":"global","author":"KPVkkpR21c13yy2y","img":"icons/magic/time/clock-spinning-gold-pink.webp","command":"(async() => {\n    const actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\n    if (actors.length === 0 && game.user.character) actors.push(game.user.character);\n    if (actors.length === 0) {\n        const message = game.i18n.localize(\"PF2E.ErrorMessage.NoTokenSelected\");\n        return ui.notifications.error(message);\n    }\n    actor = actors[0];\n\n    const label = \"Looping Spell\";\n    const skillKey = \"arcana\";\n    const actionSlug = \"looping-spell\"\n    \n    let skill = deepClone(actor.skills[skillKey]);\n    \n    skill.label = label;        \n    \n    const DC = 14 + actor.level + Math.floor(actor.level /3);\n    \n    const options = []\n    options.push(`action:${actionSlug}`); // add more traits here in new lines\n    \n    await skill.check.roll({\n        event:event,\n        dc: {value: DC},\n        skipDialog: true,\n        extraRollOptions: options,\n        callback: async (callback) => {\n            const ITEM_UUID = `Compendium.vyk-homebrew.chronomancer.RAlqPlReyU1JVMUP`;\n                        \n            const source = (await fromUuid(ITEM_UUID)).toObject();\n            source.flags = mergeObject(source.flags ?? {}, { core: { sourceId: ITEM_UUID } });\n            \n            console.log(callback);\n            \n            if(callback.options.degreeOfSuccess == 2){\n                source.system.duration.value = 3;\n                await actor.createEmbeddedDocuments(\"Item\", [source]);\n            } else if (callback.options.degreeOfSuccess == 3) {\n                source.system.duration.value = 4;\n                await actor.createEmbeddedDocuments(\"Item\", [source]);\n            }\n        }\n    })\n    \n})();","ownership":{"default":0,"KPVkkpR21c13yy2y":3},"flags":{"core":{"sourceId":"Macro.CuQqdaKJKDG8sfZR"}},"_stats":{"systemId":"pf2e","systemVersion":"4.3.4","coreVersion":"10.287","createdTime":1668460947115,"modifiedTime":1668461999730,"lastModifiedBy":"KPVkkpR21c13yy2y"},"folder":null,"sort":0,"_id":"PNyIXMB8fiRT3C0f"}
