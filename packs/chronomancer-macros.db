{"name":"Bladesong test","type":"script","author":"KPVkkpR21c13yy2y","img":"icons/svg/dice-target.svg","scope":"global","command":"Hooks.on('createCombat', async (document,data,id) => {\n    if(!document.data.flags.hasOwnProperty('vyklade')){\n        document.update({['flags.vyklade.initiated']:false});\n    }\n});\n\nHooks.on('updateCombat', async (document,data,diff,id) =>{\n    if(document.data.flags.vyklade.initiated) return;\n    if(!document.started) return;\n    \n    const UUID = \"Compendium.vyk-homebrew.bladesong.c1eGS70Zyts97NOz\";\n    \n    let source = (await fromUuid(UUID)).toObject();\n    source.flags.core ?? {};\n    source.flags.core.sourceId = UUID;\n    \n    let comb = Array.from(document.combatants.values());\n    \n    comb.forEach(async (C) => {\n        let a = C.actor;\n        let options = a.getRollOptions(['all']);\n        if(!a) return;\n        \n        if(options.includes(\"feat:bladesong-dedication\")){\n            let feat = options.includes(\"feat:shimmering-edge\");\n            \n            const existing = a.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n            if(existing){\n                let mirages = existing.data.data.level.value + (feat? 3:2);\n                \n                await existing.delete();\n                source.data.level.value = mirages;\n                source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${mirrages}.png`;\n                await a.createEmbeddedDocuments('Item', [source]);\n            }\n            else{\n                source.data.level.value = (feat? 3:2);\n                source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${(feat? 3:2)}.png`;\n                await a.createEmbeddedDocuments('Item', [source]);\n            }\n            \n        }\n        \n    });\n    \n    document.update({['flags.vyklade.initiated']:true})\n});","folder":null,"sort":0,"permission":{"default":0,"KPVkkpR21c13yy2y":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.42KlphCArjMPe1Uy"}},"_id":"QfapyihUkCBNpuX5"}
{"$$deleted":true,"_id":"QfapyihUkCBNpuX5"}
{"name":"Reset Motes","type":"script","author":"KPVkkpR21c13yy2y","img":"modules/vyk-homebrew/assets/chrono/base.png","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.chronomancer.hwBMfeUIZxCO49B0\";\n\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let int = actor.data.data.abilities.int.mod;\n        \n        let watch = actor.getRollOptions(['all']).includes(\"feature:pocket-watch\");\n        \n        let cap = int + (watch?1:0);\n        \n        \n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            await existing.delete();\n        }\n            \n        source.img = `modules/vyk-homebrew/assets/chrono/motes${Math.min(9,Math.max(1,cap))}.png`;\n        source.data.level.value = Math.max(1,cap);\n        \n        await actor.createEmbeddedDocuments('Item', [source]);\n        \n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3,"KPVkkpR21c13yy2y":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.BgstaNrT1d3mqtbP"}},"_id":"J2P5IqBnYfMpVlO3"}
{"name":"Substract Shard","type":"script","author":"KPVkkpR21c13yy2y","img":"modules/vyk-homebrew/assets/chrono/substract.png","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.chronomancer.hwBMfeUIZxCO49B0\";\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n\n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let motes = existing.data.data.level.value;\n            \n            await existing.delete();\n           \n            if(motes-1 === 0) return;\n            \n            source.data.level.value = motes-1;\n            source.img = `modules/vyk-homebrew/assets/chrono/motes${Math.min(9,motes-1)}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            ui.notifications.warn(\"You do not have any Time Motes left!\");\n            return;\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3,"KPVkkpR21c13yy2y":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.2vYeNq5TtEZNT6mf"}},"_id":"6VmkbD4FQFcyYnLj"}
