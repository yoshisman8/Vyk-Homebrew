{"_id":"1087jf2U3oMAWXmG","name":"Substract Mirages","type":"script","author":"KPVkkpR21c13yy2y","img":"modules/vyk-homebrew/assets/Bladesong/substract.png","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.bladesong.c1eGS70Zyts97NOz\";\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            let shards = existing.data.data.level.value;\n            \n            await existing.delete();\n            \n            if(shards-1 === 0) return;\n            \n            source.data.level.value = shards-1;\n            source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${shards-1}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            ui.notifications.warn(\"You do not have any mirages left!\");\n            return;\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"KPVkkpR21c13yy2y":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.G54BVjFxzoboZFRz"}}}
{"_id":"545x4tEO18W4EQxQ","name":"Bladesurge","type":"script","author":"KPVkkpR21c13yy2y","img":"icons/magic/symbols/runes-star-pentagon-magenta.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.bladesong.c1eGS70Zyts97NOz\";\n\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let options = actor.getRollOptions(['all']);\n        \n        let cap = 5;\n        let feat = options.includes('feat:shimmering-edge');\n        \n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let mirrages = existing.data.data.level.value;\n            \n            if (mirrages == 5){\n                ui.notifications.warn(\"You cannot hold any more mirrages!\");\n                return;\n            }\n            \n            let value = Math.min(5,mirrages+4);\n            \n            await existing.delete();\n            \n            source.data.level.value = value;\n            source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${value}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            \n            source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage4.png`;\n            source.data.level.value = 4;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"KPVkkpR21c13yy2y":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.SJRWsd7ArkygmjvP"}}}
{"_id":"PNIf88Wq6e5sDgMS","name":"Bladecall","type":"script","author":"KPVkkpR21c13yy2y","img":"icons/magic/fire/dagger-rune-enchant-purple-orange.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.bladesong.c1eGS70Zyts97NOz\";\n\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let options = actor.getRollOptions(['all']);\n        \n        let cap = 5;\n        let feat = options.includes('feat:shimmering-edge');\n        \n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let mirrages = existing.data.data.level.value;\n            \n            if (mirrages == 5){\n                ui.notifications.warn(\"You cannot hold any more mirrages!\");\n                return;\n            }\n            \n            let value = Math.min(5,mirrages+(feat?3:2));\n            \n            await existing.delete();\n            \n            source.data.level.value = value;\n            source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${value}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            \n            source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${(feat?3:2)}.png`;\n            source.data.level.value = (feat?3:2);\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"KPVkkpR21c13yy2y":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.SJRWsd7ArkygmjvP"}}}
{"name":"Sorrowful Song","type":"script","author":"KPVkkpR21c13yy2y","img":"icons/magic/control/hypnosis-mesmerism-eye.webp","scope":"global","command":"if (!actor) {\n    ui.notifications.warn(\"You must have an actor selected\");\n} else {\n    if(Array.from(game.user.targets).length == 0){\n        ui.notifications.warn(\"You must have a target selected\");\n        return;\n    }\n    const target = Array.from(game.user.targets)[0];\n    const skillName = \"Deception\";\n    const skillKey = \"dec\";\n    const actionSlug = \"sorrowful-song\"\n    const actionName = \"Sorrowful Song\"\n    \n    const modifiers = []\n    // list custom modifiers for a single roll here\n    //const modifiers = [\n    //new game.pf2e.Modifier('Expanded Healer\\'s Tools', 1, 'item')\n    //];\n    const level = actor.data.data.details.level.value;\n    \n    const DC = target.actor.data.data.saves.will.value + 10;\n    \n    const notes = [...token.actor.data.data.skills[skillKey].notes]; // add more notes if necessary\n    const options = token.actor.getRollOptions(['all', 'skill-check', skillName.toLowerCase()]);\n    \n    options.push(`action:${actionSlug}`); // add more traits here in new lines\n    \n    options.push(`mental`);\n    \n    options.push(`magical`);\n    \n    game.pf2e.Check.roll(\n    new game.pf2e.CheckModifier(\n        `<b>${actionName}</b> - <p class=\"compact-text\">${skillName } Skill Check</p>`,\n        token.actor.data.data.skills[skillKey], modifiers ),\n        { actor: token.actor, type: 'skill-check', options, notes, dc: {value: DC}},\n        event\n    );\n    \n}","folder":null,"sort":0,"permission":{"default":0,"KPVkkpR21c13yy2y":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.IuHcghOHZEpF7HAV"}},"_id":"nUX7SXBKDeItsAAQ"}
