{"_id":"1087jf2U3oMAWXmG","name":"Substract Mirages","type":"script","author":"KPVkkpR21c13yy2y","img":"modules/vyk-homebrew/assets/Bladesong/substract.png","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.bladesong.c1eGS70Zyts97NOz\";\n\n(async () =>{\n    const actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\n    if (actors.length === 0 && game.user.character) actors.push(game.user.character);\n    if (actors.length === 0) {\n        const message = game.i18n.localize(\"PF2E.ErrorMessage.NoTokenSelected\");\n        return ui.notifications.error(message);\n    }\n    actor = actors[0];\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let source = (await fromUuid(UUID)).toObject();\n        source.flags = mergeObject(source.flags ?? {}, { core: { sourceId: UUID } });\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((e) => e.flags.core?.sourceId === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            let shards = existing.system.level.value;\n            \n            await existing.delete();\n            \n            if(shards-1 === 0) return;\n            \n            source.system.level.value = shards-1;\n            source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${shards-1}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            ui.notifications.warn(\"You do not have any mirages left!\");\n            return;\n        }\n    }\n})();","folder":null,"sort":0,"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.G54BVjFxzoboZFRz"}},"ownership":{"default":0,"KPVkkpR21c13yy2y":3},"_stats":{"systemId":"pf2e","systemVersion":"4.2.5","coreVersion":"10.287","createdTime":null,"modifiedTime":1665599310813,"lastModifiedBy":"KPVkkpR21c13yy2y"}}
{"_id":"545x4tEO18W4EQxQ","name":"Bladesurge","type":"script","author":"KPVkkpR21c13yy2y","img":"icons/magic/symbols/runes-star-pentagon-magenta.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.bladesong.c1eGS70Zyts97NOz\";\n\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let options = actor.getRollOptions(['all']);\n        \n        let cap = 5;\n        let feat = options.includes('feat:shimmering-edge');\n        \n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let mirrages = existing.system.level.value;\n            \n            if (mirrages == 5){\n                ui.notifications.warn(\"You cannot hold any more mirrages!\");\n                return;\n            }\n            \n            let value = Math.min(5,mirrages+4);\n            \n            await existing.delete();\n            \n            source.system.level.value = value;\n            source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${value}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            \n            source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage4.png`;\n            source.system.level.value = 4;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n        }\n    }\n})();","folder":null,"sort":0,"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.SJRWsd7ArkygmjvP"}},"ownership":{"default":0,"KPVkkpR21c13yy2y":3},"_stats":{"systemId":"pf2e","systemVersion":"4.2.5","coreVersion":"10.287","createdTime":null,"modifiedTime":1665598591572,"lastModifiedBy":"KPVkkpR21c13yy2y"}}
{"name":"Curtain Call (Shatter 5)","type":"script","author":"KPVkkpR21c13yy2y","img":"icons/magic/air/wind-vortex-swirl-blue.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.bladesong.c1eGS70Zyts97NOz\";\n\n(async () =>{\n    const actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\n    if (actors.length === 0 && game.user.character) actors.push(game.user.character);\n    if (actors.length === 0) {\n        const message = game.i18n.localize(\"PF2E.ErrorMessage.NoTokenSelected\");\n        return ui.notifications.error(message);\n    }\n    actor = actors[0];\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let source = (await fromUuid(UUID)).toObject();\n        source.flags = mergeObject(source.flags ?? {}, { core: { sourceId: UUID } });\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((e) => e.flags.core?.sourceId === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            let shards = existing.system.level.value;\n            \n            if(shards < 5) return ui.notifications.error(\"Not enough Mirages!\");\n            await existing.delete();\n            \n            if(shards-5 <= 0) return;\n            \n            source.system.level.value = shards-5;\n            source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${shards-1}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            ui.notifications.warn(\"You do not have any mirages left!\");\n            return;\n        }\n    }\n})();","flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.G54BVjFxzoboZFRz"}},"ownership":{"default":0,"KPVkkpR21c13yy2y":3},"_stats":{"systemId":"pf2e","systemVersion":"4.2.5","coreVersion":"10.287","createdTime":1665602676058,"modifiedTime":1665602882144,"lastModifiedBy":"KPVkkpR21c13yy2y"},"folder":null,"sort":0,"_id":"ITgaVuZJEz3vibRm"}
{"_id":"PNIf88Wq6e5sDgMS","name":"Bladecall","type":"script","author":"KPVkkpR21c13yy2y","img":"icons/magic/fire/dagger-rune-enchant-purple-orange.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.bladesong.c1eGS70Zyts97NOz\";\n\n\n(async () =>{\n    const actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\n    if (actors.length === 0 && game.user.character) actors.push(game.user.character);\n    if (actors.length === 0) {\n        const message = game.i18n.localize(\"PF2E.ErrorMessage.NoTokenSelected\");\n        return ui.notifications.error(message);\n    }\n    actor = actors[0];\n    \n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let options = actor.getRollOptions(['all']);\n        \n        let cap = 5;\n        let feat = options.includes('feat:shimmering-edge');\n        \n        const source = (await fromUuid(UUID)).toObject();\n        source.flags = mergeObject(source.flags ?? {}, { core: { sourceId: UUID } });\n\n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((e) => e.flags.core?.sourceId === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let mirrages = existing.system.level.value;\n            \n            if (mirrages == 5){\n                ui.notifications.warn(\"You cannot hold any more mirrages!\");\n                return;\n            }\n            \n            let value = Math.min(5,mirrages+(feat?3:2));\n            \n            await existing.delete();\n            \n            source.system.level.value = value;\n            source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${value}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            \n            source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${(feat?3:2)}.png`;\n            source.system.level.value = (feat?3:2);\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n        }\n    }\n})();","folder":null,"sort":0,"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.SJRWsd7ArkygmjvP"}},"ownership":{"default":0,"KPVkkpR21c13yy2y":3},"_stats":{"systemId":"pf2e","systemVersion":"4.2.5","coreVersion":"10.287","createdTime":null,"modifiedTime":1665599026810,"lastModifiedBy":"KPVkkpR21c13yy2y"}}
{"name":"Flying Cutter (Shatter 2)","type":"script","author":"KPVkkpR21c13yy2y","img":"icons/skills/melee/strike-dagger-arcane-pink.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.bladesong.c1eGS70Zyts97NOz\";\n\n(async () =>{\n    const actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\n    if (actors.length === 0 && game.user.character) actors.push(game.user.character);\n    if (actors.length === 0) {\n        const message = game.i18n.localize(\"PF2E.ErrorMessage.NoTokenSelected\");\n        return ui.notifications.error(message);\n    }\n    actor = actors[0];\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let source = (await fromUuid(UUID)).toObject();\n        source.flags = mergeObject(source.flags ?? {}, { core: { sourceId: UUID } });\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((e) => e.flags.core?.sourceId === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            let shards = existing.system.level.value;\n            \n            if(shards < 2) return ui.notifications.error(\"Not enough Mirages!\");\n            await existing.delete();\n            \n            if(shards-2 <= 0) return;\n            \n            source.system.level.value = shards-2;\n            source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${shards-1}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            ui.notifications.warn(\"You do not have any mirages left!\");\n            return;\n        }\n    }\n})();","flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.G54BVjFxzoboZFRz"}},"ownership":{"default":0,"KPVkkpR21c13yy2y":3},"_stats":{"systemId":"pf2e","systemVersion":"4.2.5","coreVersion":"10.287","createdTime":1665602676058,"modifiedTime":1665602756000,"lastModifiedBy":"KPVkkpR21c13yy2y"},"folder":null,"sort":0,"_id":"ig7fRDwCstXVBgfQ"}
{"name":"Sorrowful Song","type":"script","author":"KPVkkpR21c13yy2y","img":"icons/magic/control/hypnosis-mesmerism-eye.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.bladesong.c1eGS70Zyts97NOz\";\nconst actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\nif (actors.length === 0 && game.user.character) actors.push(game.user.character);\nif (actors.length === 0) {\n    const message = game.i18n.localize(\"PF2E.ErrorMessage.NoTokenSelected\");\n    return ui.notifications.error(message);\n}\nactor = actors[0];\nconst target = Array.from(game.user.targets)[0];\n\nif(!target){\n    ui.notifications.error(\"You must have a token targetted!\");\n    return;\n} \n\nif (!actor) {\n    ui.notifications.warn(\"You must have an actor selected\");\n} else {\n    const existing = actor.itemTypes.effect.find((e) => e.flags.core?.sourceId === UUID);\n    \n    if(!existing || existing.system.level.value < 3){\n        return ui.notifications.warn(`${actor.name} does not have at least 3 Mirages!`);\n    }\n    \n    const source = (await fromUuid(UUID)).toObject();\n    source.flags = mergeObject(source.flags ?? {}, { core: { sourceId: UUID } })\n    \n    let mirages = existing.system.level.value -3;\n    \n    await existing.delete();\n    \n    await existing.delete();\n            \n    source.system.level.value = mirages;\n    source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${value}.png`;\n    \n    await actor.createEmbeddedDocuments('Item', [source]);\n    \n    const target = Array.from(game.user.targets)[0];\n    const skillName = \"Deception\";\n    const skillKey = \"deception\";\n    const actionSlug = \"sorrowful-song\"\n    const actionName = \"Sorrowful Song\"\n    \n    const modifiers = []\n    // list custom modifiers for a single roll here\n    //const modifiers = [\n    //new game.pf2e.Modifier('Expanded Healer\\'s Tools', 1, 'item')\n    //];\n    const level = actor.level;\n    \n    const DC = target.actor.system.saves.will.value + 10;\n    \n    const options = token.actor.getRollOptions(['all', 'skill-check', skillKey]);\n    \n    options.push(`action:${actionSlug}`); // add more traits here in new lines\n    \n    options.push(`mental`);\n    \n    options.push(`magical`);\n    \n    game.pf2e.Check.roll(\n    new game.pf2e.CheckModifier(\n        `<b>${actionName}</b> - <p class=\"compact-text\">${skillName } Skill Check</p>`,\n        token.actor.skills[skillKey], modifiers ),\n        { actor: token.actor, type: 'skill-check', options, dc: {value: DC}},\n        event\n    );\n    \n}","folder":null,"sort":0,"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.IuHcghOHZEpF7HAV"}},"_id":"nUX7SXBKDeItsAAQ","ownership":{"default":0,"KPVkkpR21c13yy2y":3},"_stats":{"systemId":"pf2e","systemVersion":"4.2.5","coreVersion":"10.287","createdTime":null,"modifiedTime":1665599187641,"lastModifiedBy":"KPVkkpR21c13yy2y"}}
{"name":"Bladed Requiem","type":"script","author":"KPVkkpR21c13yy2y","img":"icons/magic/life/cross-explosion-burst-green.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.bladesong.c1eGS70Zyts97NOz\";\n\n(async () =>{\n    \n    async function query(shards){\n        return new Promise((resolve, reject) => {\n            let buttons = {};\n            \n            for(let i = 0; i < shards; i++){\n                buttons[`${i}`] = { label:`${i+1}`, callback: () => {resolve(i+1);}};\n            }\n            \n            buttons[\"cancel\"] = { label:`Cancel`, callback: () => {resolve(0)}};\n            \n            const dialog = new Dialog({\n                title: `Bladed Requiem`,\n                content:`Choose amount of Mirages to spend.`,\n                buttons: buttons,\n                rejectClose: true,\n                close: () => { resolve(0) }\n            });\n            \n            dialog.render (true); \n        });\n    }\n    \n    const actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\n    if (actors.length === 0 && game.user.character) actors.push(game.user.character);\n    if (actors.length === 0) {\n        const message = game.i18n.localize(\"PF2E.ErrorMessage.NoTokenSelected\");\n        return ui.notifications.error(message);\n    }\n    actor = actors[0];\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let source = (await fromUuid(UUID)).toObject();\n        source.flags = mergeObject(source.flags ?? {}, { core: { sourceId: UUID } });\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((e) => e.flags.core?.sourceId === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            let shards = existing.system.level.value;\n            \n            let spent = await query(shards);\n            \n            if(spent === 0) return;\n            \n            await existing.delete();\n            \n            if(shards-spent <= 0) return;\n            \n            source.system.level.value = shards-spent;\n            source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${shards-spent}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n            let roll = new Roll(`${spent} * ${actor.level}`);\n            await roll.toMessage({flavor:`Bladed Requiem - Healing`});\n            \n        } else{\n            ui.notifications.warn(\"You do not have any mirages left!\");\n            return;\n        }\n    }\n})();","flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.G54BVjFxzoboZFRz"}},"ownership":{"default":0,"KPVkkpR21c13yy2y":3},"_stats":{"systemId":"pf2e","systemVersion":"4.2.5","coreVersion":"10.287","createdTime":1665602676058,"modifiedTime":1665603947736,"lastModifiedBy":"KPVkkpR21c13yy2y"},"folder":null,"sort":0,"_id":"os99SKGKyC7vtDXP"}
{"name":"Bladed Requiem","type":"script","author":"KPVkkpR21c13yy2y","img":"icons/magic/life/cross-explosion-burst-green.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.bladesong.c1eGS70Zyts97NOz\";\n\n(async () =>{\n    \n    async function query(shards){\n        return new Promise((resolve, reject) => {\n            let buttons = {};\n            \n            for(let i = 0; i < shards; i++){\n                buttons[`${i}`] = { label:`${i+1}`, callback: () => {resolve(i+1);}};\n            }\n            \n            buttons[\"cancel\"] = { label:`Cancel`, callback: () => {resolve(0)}};\n            \n            const dialog = new Dialog({\n                title: `Bladed Requiem`,\n                content:`Choose amount of Mirages to spend.`,\n                buttons: buttons,\n                rejectClose: true,\n                close: () => { resolve(0) }\n            });\n            \n            dialog.render (true); \n        });\n    }\n    \n    const actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\n    if (actors.length === 0 && game.user.character) actors.push(game.user.character);\n    if (actors.length === 0) {\n        const message = game.i18n.localize(\"PF2E.ErrorMessage.NoTokenSelected\");\n        return ui.notifications.error(message);\n    }\n    actor = actors[0];\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let source = (await fromUuid(UUID)).toObject();\n        source.flags = mergeObject(source.flags ?? {}, { core: { sourceId: UUID } });\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((e) => e.flags.core?.sourceId === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            let shards = existing.system.level.value;\n            \n            let spent = await query(shards);\n            \n            if(spent === 0) return;\n            \n            await existing.delete();\n            \n            let roll = new Roll(`${spent} * ${actor.level}`);\n            await roll.toMessage({flavor:`Bladed Requiem - Healing`});\n            \n            if(shards-spent <= 0) return;\n            \n            source.system.level.value = shards-spent;\n            source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${shards-spent}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n            \n            \n        } else{\n            ui.notifications.warn(\"You do not have any mirages left!\");\n            return;\n        }\n    }\n})();","flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.G54BVjFxzoboZFRz"}},"ownership":{"default":0,"KPVkkpR21c13yy2y":3},"_stats":{"systemId":"pf2e","systemVersion":"4.2.5","coreVersion":"10.287","createdTime":1665602676058,"modifiedTime":1665604233585,"lastModifiedBy":"KPVkkpR21c13yy2y"},"folder":null,"sort":0,"_id":"os99SKGKyC7vtDXP"}
{"name":"Bladed Requiem (Shatter 1+)","type":"script","author":"KPVkkpR21c13yy2y","img":"icons/magic/life/cross-explosion-burst-green.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.bladesong.c1eGS70Zyts97NOz\";\n\n(async () =>{\n    \n    async function query(shards){\n        return new Promise((resolve, reject) => {\n            let buttons = {};\n            \n            for(let i = 0; i < shards; i++){\n                buttons[`${i}`] = { label:`${i+1}`, callback: () => {resolve(i+1);}};\n            }\n            \n            buttons[\"cancel\"] = { label:`Cancel`, callback: () => {resolve(0)}};\n            \n            const dialog = new Dialog({\n                title: `Bladed Requiem`,\n                content:`Choose amount of Mirages to spend.`,\n                buttons: buttons,\n                rejectClose: true,\n                close: () => { resolve(0) }\n            });\n            \n            dialog.render (true); \n        });\n    }\n    \n    const actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\n    if (actors.length === 0 && game.user.character) actors.push(game.user.character);\n    if (actors.length === 0) {\n        const message = game.i18n.localize(\"PF2E.ErrorMessage.NoTokenSelected\");\n        return ui.notifications.error(message);\n    }\n    actor = actors[0];\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let source = (await fromUuid(UUID)).toObject();\n        source.flags = mergeObject(source.flags ?? {}, { core: { sourceId: UUID } });\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((e) => e.flags.core?.sourceId === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            let shards = existing.system.level.value;\n            \n            let spent = await query(shards);\n            \n            if(spent === 0) return;\n            \n            await existing.delete();\n            \n            let roll = new Roll(`${spent} * ${actor.level}`);\n            await roll.toMessage({flavor:`Bladed Requiem - Healing`});\n            \n            if(shards-spent <= 0) return;\n            \n            source.system.level.value = shards-spent;\n            source.img = `modules/vyk-homebrew/assets/Bladesong/mirrage${shards-spent}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n            \n            \n        } else{\n            ui.notifications.warn(\"You do not have any mirages left!\");\n            return;\n        }\n    }\n})();","flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.G54BVjFxzoboZFRz"}},"ownership":{"default":0,"KPVkkpR21c13yy2y":3},"_stats":{"systemId":"pf2e","systemVersion":"4.2.5","coreVersion":"10.287","createdTime":1665602676058,"modifiedTime":1665604246373,"lastModifiedBy":"KPVkkpR21c13yy2y"},"folder":null,"sort":0,"_id":"os99SKGKyC7vtDXP"}
