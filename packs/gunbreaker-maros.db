{"name":"Discharge","permission":{"default":0,"p8gkGCKPkXtqoQrU":3},"type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.PnbalKhK7yXplayS"}},"scope":"global","command":"if (!actor) {\n  ui.notifications.warn(\"You must select yourself.\");\n}\n\nlet updates = [];\nlet consumed = \"\";\nlet roll = \"\";\n// Use Bolts\n(async () => {\n\nlet item = actor.items.find(i=> i.name===\"Gunblade Cartridge\");\n\nif(item === null) return\n\nif (item.data.data.charges.value < 1) {\n\n  ui.notifications.warn(`${game.user.name} your gunblade is empty!`);\nreturn\n} else {\n\n  updates.push({\"_id\": item._id, \"data.charges.value\": item.data.data.charges.value - 1});\n\nconsumed += \"Unleashes a Discharge!\\n\";\nconsumed += `${item.data.data.charges.value - 1} Cartridges left in cilinder<br>`;\nroll = new Roll('1d6').roll();\n}\n\nif (updates.length > 0) {\n  actor.updateEmbeddedEntity(\"OwnedItem\", updates);\n}\nChatMessage.create({\n  user: game.user._id,\nspeaker: ChatMessage.getSpeaker(),\n  content: consumed,\n  type: CONST.CHAT_MESSAGE_TYPES.OTHER\n});\nChatMessage.create({\n    user: game.user._id,\n    speaker: ChatMessage.getSpeaker(),\n    flavor: \"Discharge Damage\",\n    type: CONST.CHAT_MESSAGE_TYPES.ROLL,\n    roll\n});\n })();","author":"p8gkGCKPkXtqoQrU","img":"modules/vyk-homebrew/assets/gunbreaker/Burst_Strike.png","actorIds":[],"_id":"BSvo1cHZsHBTvyKm"}
{"name":"Buster Shot","permission":{"default":0,"p8gkGCKPkXtqoQrU":3},"type":"script","flags":{"furnace":{"runAsGM":false},"exportSource":{"world":"extcurse","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.12.1.5052"},"core":{"sourceId":"Macro.PSfnHI27h82kQ3sG"}},"scope":"global","command":"const dice = 2; // Change to the number of damage dice your weapon has\n\nif (!actor) {\n  ui.notifications.warn(\"You must select yourself.\");\n}\n\nlet updates = [];\nlet consumed = \"\";\nlet roll = \"\";\n// Use Bolts\n(async () => {\n\nlet item = actor.items.find(i=> i.name===\"Gunblade Cartridge\");\n\nif(item === null) return\n\nif (item.data.data.charges.value < 1) {\n\n  ui.notifications.warn(`${game.user.name} your gunblade is empty!`);\nreturn\n} else {\n\n  updates.push({\"_id\": item._id, \"data.charges.value\": item.data.data.charges.value - 1});\n\nconsumed += \"Shoots a cartridge!\\n\";\nconsumed += `${item.data.data.charges.value - 1} Cartridges left in cilinder<br>`;\nroll = new Roll(`${dice}d6`).roll();\n}\n\nif (updates.length > 0) {\n  actor.updateEmbeddedEntity(\"OwnedItem\", updates);\n}\nChatMessage.create({\n  user: game.user._id,\nspeaker: ChatMessage.getSpeaker(),\n  content: consumed,\n  type: CONST.CHAT_MESSAGE_TYPES.OTHER\n});\nChatMessage.create({\n    user: game.user._id,\n    speaker: ChatMessage.getSpeaker(),\n    flavor: \"Buster Shot Damage\",\n    type: CONST.CHAT_MESSAGE_TYPES.ROLL,\n    roll\n});\n })();","author":"p8gkGCKPkXtqoQrU","img":"modules/vyk-homebrew/assets/gunbreaker/Lightning_Shot.png","actorIds":[],"_id":"DKTOZS3B6ZMeWG2H"}
{"_id":"ELCheVQ1HWxcrRgy","name":"Gunbreaker Daily Preparations","permission":{"default":0,"p8gkGCKPkXtqoQrU":3},"type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.nrGTYKOSgvcoEIQ8"}},"scope":"global","command":"if (!actor) {\n  ui.notifications.warn(\"You must select yourself.\");\n}\n\nlet updates = [];\nlet consumed = \"\";\n(async () => {\n\nlet item = actor.items.find(i=> i.name===\"Gunblade Cartridge\");\nlet bandolier = actor.items.find(i=> i.name===\"Cartridge Bandolier\");\n\nif(item === null || bandolier === null) return\n\nlet reserve = 2 + token.actor.data.data.details.level.value - item.data.data.charges.max;\n\nupdates.push({\"_id\": bandolier._id, \"data.charges.max\": reserve, \"data.charges.value\": reserve});\nupdates.push({\"_id\": item._id, \"data.charges.value\": item.data.data.charges.max});\n\nconsumed += `Daily Preparations complete!<br>`;\nconsumed += `${reserve} Cartridges infused and stored.<br>`;\nconsumed += `${item.data.data.charges.max} Cartridges loaded into Gunblade.<br>`;\n\nif (updates.length > 0) {\n  actor.updateEmbeddedEntity(\"OwnedItem\", updates);\n}\nChatMessage.create({\n  user: game.user._id,\n  speaker: ChatMessage.getSpeaker(),\n  content: consumed,\n  type: CONST.CHAT_MESSAGE_TYPES.OTHER,\n  whisper: ChatMessage.getWhisperRecipients('GM')\n});\n  })();","author":"p8gkGCKPkXtqoQrU","img":"modules/vyk-homebrew/assets/gunbreaker/Heart_of_Light.png","actorIds":[]}
{"_id":"lvo4kLK4bx8Pde10","name":"Reload","permission":{"default":0,"p8gkGCKPkXtqoQrU":3},"type":"script","flags":{"furnace":{"runAsGM":false},"exportSource":{"world":"extcurse","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.12.1.5052"},"core":{"sourceId":"Macro.43NLSzHf3t0n7ISZ"}},"scope":"global","command":"if (!actor) {\n  ui.notifications.warn(\"You must select yourself.\");\n}\n\nlet updates = [];\nlet consumed = \"\";\n(async () => {\n\nlet item = actor.items.find(i=> i.name===\"Gunblade Cartridge\");\nlet bandolier = actor.items.find(i=> i.name===\"Cartridge Bandolier\");\n\nif(item === null || bandolier === null) return\n\nlet capacity = 0;\ncapacity = item.data.data.charges.max;\nlet charges = 0;\ncharges = bandolier.data.data.charges.value;\nlet missing = 0;\nmissing = capacity - item.data.data.charges.value;\nlet gained = Math.min(charges, missing);\n\nif (bandolier.data.data.charges.value < 1) {\n\n  ui.notifications.warn(`${game.user.name} you have no more cartridges left!`);\nreturn\n} else {\n  \n\n  updates.push({\"_id\": item._id, \"data.charges.value\": item.data.data.charges.value + gained});\n  updates.push({\"_id\": bandolier._id, \"data.charges.value\": bandolier.data.data.charges.value - gained});\n\n  consumed += `Reloads his gunblade<br>`;\n  consumed += `${item.data.data.charges.value + gained}/${item.data.data.charges.max} Cartridges in Gunblade.<br>`;\n  consumed += `${bandolier.data.data.charges.value - gained}/${bandolier.data.data.charges.max} Cartridges left in bandolier.<br>`;\n}\n\nif (updates.length > 0) {\n  actor.updateEmbeddedEntity(\"OwnedItem\", updates);\n}\nChatMessage.create({\n  user: game.user._id,\n  speaker: ChatMessage.getSpeaker(),\n  content: consumed,\n  type: CONST.CHAT_MESSAGE_TYPES.OTHER,\n  whisper: ChatMessage.getWhisperRecipients('GM')\n});\n  })();","author":"p8gkGCKPkXtqoQrU","img":"Homebrew/Bloodfest.png","actorIds":[]}
{"_id":"wzYaIduqJfZTS3u9","name":"Aetherflow","permission":{"default":0,"p8gkGCKPkXtqoQrU":3},"type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.My9QkO3XwOkMGoxy"}},"scope":"global","command":"if (!actor) {\n  ui.notifications.warn(\"You must select yourself.\");\n}\n\nlet updates = [];\nlet consumed = \"\";\n(async () => {\n\nlet item = actor.items.find(i=> i.name===\"Gunblade Cartridge\");\nlet bandolier = actor.items.find(i=> i.name===\"Cartridge Bandolier\");\n\nif(item === null || bandolier === null) return\n\nif (item.data.data.charges.value < item.data.data.charges.max) {\n  updates.push({\"_id\": item._id, \"data.charges.value\": item.data.data.charges.value + 1});\n  consumed += `Regained 1 Cartridge.<br>`;\n  consumed += `${item.data.data.charges.value + 1} Cartridges loaded in Gunblade.<br>`;\n} else if (\n  item.data.data.charges.value >= item.data.data.charges.max \n  && bandolier.data.data.charges.value < bandolier.data.data.charges.max) \n  {\n    updates.push({\"_id\": bandolier._id, \"data.charges.value\": bandolier.data.data.charges.value + 1});\n    consumed += `Regained 1 Stored Cartridge.<br>`;\n    consumed += `${bandolier.data.data.charges.value + 1} Cartridges in bandolier.<br>`;\n} else {\n  ui.notifications.warn(`${game.user.name} Both your loaded and reserve cartridges are full!`);\nreturn\n}\n\nif (updates.length > 0) {\n  actor.updateEmbeddedEntity(\"OwnedItem\", updates);\n}\nChatMessage.create({\n  user: game.user._id,\n  speaker: ChatMessage.getSpeaker(),\n  content: consumed,\n  type: CONST.CHAT_MESSAGE_TYPES.OTHER,\n  whisper: ChatMessage.getWhisperRecipients('GM')\n});\n  })();","author":"p8gkGCKPkXtqoQrU","img":"modules/vyk-homebrew/assets/gunbreaker/No_Mercy.png","actorIds":[]}
