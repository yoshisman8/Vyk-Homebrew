{"_id":"DH6SMm9cAVsecepS","name":"Enshroud","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"icons/magic/unholy/silhouette-robe-evil-glow.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.reaper.I0dHV996KYyVFt6E\";\nconst UUID2 = \"Compendium.vyk-homebrew.reaper.Wd6LqBX4vGpL9Jxp\";\n\n(async () => {\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let feature = actor.items.some(f=>f.name ===\"Soul Reaping\");\n        \n        if (!feature){\n            ui.notifications.warn(\"You lack the Soul Reaping class feature!\");\n            return;\n        }\n        \n        let lv = actor.data.data.details.level.value;\n        \n        let feat = actor.items.some(f=>f.name === \"Fragments of the Soul\");\n        \n        let cap = lv>=5 ? (lv>=13 ? 4:3) :2;\n        \n        if(feat) cap++;\n\n        let shardSource = (await fromUuid(UUID)).toObject();\n        shardSource.flags.core ?? {};\n        shardSource.flags.core.sourceId = UUID;\n        \n        \n        let source = (await fromUuid(UUID2)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID2;\n        \n        const enshroud = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID2);\n        \n        const existingShards = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(enshroud){\n            await enshroud.delete();\n            await existingShards.delete(); \n        } else{\n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n            if(existingShards){\n                \n                let shards = existingShards.data.data.level.value;\n                \n                \n                shardSource.img = `modules/vyk-homebrew/assets/reaper/${cap}.svg`;\n                shardSource.data.level.value = cap;\n                \n                await existingShards.delete();\n                await actor.createEmbeddedDocuments('Item', [shardSource]);\n                \n            } else{\n\n                shardSource.img = `modules/vyk-homebrew/assets/reaper/${cap}.svg`;\n                shardSource.data.level.value = cap;\n                \n                await actor.createEmbeddedDocuments('Item', [shardSource]);\n            }\n            \n            \n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.licGHcsofMygL6hz"}}}
{"_id":"EJsdlWNQ20ltHwOQ","name":"Add Shard","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"modules/vyk-homebrew/assets/reaper/add.svg","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.reaper.I0dHV996KYyVFt6E\";\n\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let lv = actor.data.data.details.level.value;\n        \n        let mastery = lv >= 2;\n        \n        let feat = actor.items.some(f=>f.name === \"Fragments of the Soul\");\n        \n        let ded = actor.items.some(f=>f.name === \"Reaper Dedication\");\n        \n        let ded2 = actor.items.some(f=>f.name === \"Soul Sanctum\");\n        \n        let cap = lv>=5?(lv>=13?4:3):2;\n        \n        if(feat) cap++;\n        \n        if(ded) cap = 1;\n        \n        if(ded2) cap = 2;\n        \n        console.log(`Lv: ${lv}\\nHas Feat?: ${feat}\\nShard Cap:${cap}`);\n        \n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let shards = existing.data.data.level.value;\n            \n\n            if(shards+1 > cap){\n                ui.notifications.warn(\"You're already at maximum Soul Shard capacity!\");\n                return;\n            }\n            \n            await existing.delete();\n            \n            source.data.level.value = shards+1;\n            source.img = `modules/vyk-homebrew/assets/reaper/${Math.min(10,shards+1)}.svg`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            \n            source.img = `modules/vyk-homebrew/assets/reaper/1.svg`;\n            source.data.level.value = 1;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.BgstaNrT1d3mqtbP"}}}
{"name":"Envelop","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"icons/magic/unholy/silhouette-robe-evil-power.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.reaper.I0dHV996KYyVFt6E\";\nconst UUID2 = \"Compendium.vyk-homebrew.reaper.Wd6LqBX4vGpL9Jxp\";\n\n(async () => {\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let ded = actor.items.some(f=>f.name === \"Reaper Dedication\");\n        \n        let ded2 = actor.items.some(f=>f.name === \"Soul Sanctum\");\n        \n        if(!ded){\n            ui.notifications.warn(\"You do not have the Repaer Dedication!\");\n            return;\n        }\n\n        let cap = 1;\n        \n        if(feat) cap = 2;\n\n        let shardSource = (await fromUuid(UUID)).toObject();\n        shardSource.flags.core ?? {};\n        shardSource.flags.core.sourceId = UUID;\n        \n        \n        let source = (await fromUuid(UUID2)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID2;\n        \n        const enshroud = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID2);\n        \n        const existingShards = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(enshroud){\n            await enshroud.delete();\n            await existingShards.delete(); \n        } else{\n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n            if(existingShards){\n                \n                let shards = existingShards.data.data.level.value;\n                \n                \n                shardSource.img = `modules/vyk-homebrew/assets/reaper/${cap}.svg`;\n                shardSource.data.level.value = cap;\n                \n                await existingShards.delete();\n                await actor.createEmbeddedDocuments('Item', [shardSource]);\n                \n            } else{\n\n                shardSource.img = `modules/vyk-homebrew/assets/reaper/${cap}.svg`;\n                shardSource.data.level.value = cap;\n                \n                await actor.createEmbeddedDocuments('Item', [shardSource]);\n            }\n            \n            \n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.licGHcsofMygL6hz"}},"_id":"HAET1lHroJjptSta"}
{"_id":"QCTSZJ2TiXcF1DfM","name":"Avatar Damage","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"icons/magic/unholy/hand-claw-fire-blue.webp","scope":"global","command":"if (!actor) {\n    ui.notifications.warn(\"You must have an actor selected\");\n} else {\n    let dedication = actor.items.some(f=>f.name ===`Reaper Dedication`);\n    \n    let feat = actor.items.some(f=>f.name ===`Manifest Death's Will`);\n    \n    let lv = actor.data.data.details.level.value;\n    \n    let die = dedication? 1:(2 + Math.floor((lv-1)/4));\n    \n    let roll = new Roll(`${die}d${dedication?(feat?6:4):6}[negative]`);\n    \n    roll.toMessage({flavor:\"Avatar Damage - Negative\"});\n}","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.uqcKYYMvsUP6lCDG"}}}
{"_id":"mofcCtrNluwD83W9","name":"Substract Shard","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"modules/vyk-homebrew/assets/reaper/subtract.svg","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.reaper.I0dHV996KYyVFt6E\";\nconst UUID2 = \"Compendium.vyk-homebrew.reaper.Wd6LqBX4vGpL9Jxp\";\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let Enshroud = actor.itemTypes.effect.find((effect) => effect.getFlag('core','sourceId') === UUID2);\n        \n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let shards = existing.data.data.level.value;\n            \n            await existing.delete();\n\n            if(shards-1 === 0) {\n                if(Enshroud){\n                    await Enshroud.delete()\n                }\n                return;\n            }\n            \n            source.data.level.value = shards-1;\n            source.img = `modules/vyk-homebrew/assets/reaper/${Math.min(10,shards-1)}.svg`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            ui.notifications.warn(\"You do not have any Soul Shards left!\");\n            return;\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.2vYeNq5TtEZNT6mf"}}}
