{"_id":"07JEnzafmxZn0Mtd","name":"Baleful Gouge","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"icons/magic/unholy/hand-claw-fire-blue.webp","scope":"global","command":"let dieSize = {\n    0:4,\n    1:6,\n    2:8,\n    3:10,\n    4:12\n}\n\nif (!actor) {\n    ui.notifications.warn(\"You must have an actor selected\");\n} else {\n    let options = actor.getRollOptions(['all']);\n    \n    let dmgType = actor.data.data.custom.modifiers.fiendishDamage;\n    \n    let feat = options.some(f=>f ===`feat:grim-reaper`);\n    \n    let lv = actor.data.data.details.level.value;\n    \n    let dice = 2 + Math.floor((lv-1)/4);\n    \n    let size = 2;\n    \n    if(feat) size++;\n    \n    let roll = new Roll(`${dice}d${dieSize[size]}[evil]`);\n    \n    roll.toMessage({flavor:\"Baleful Gouge Damage - Evil\"});\n}","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.uqcKYYMvsUP6lCDG"}}}
{"_id":"EJsdlWNQ20ltHwOQ","name":"Add Shard","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"modules/vyk-homebrew/assets/reaper/add.png","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.reaper.I0dHV996KYyVFt6E\";\n\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let wis = actor.data.data.abilities.wis.mod;\n        \n        let cap = 1 + wis;\n        \n        let dedication = (actor.getRollOptions(['all'])).some(x=>x === \"self:feat:reaper-dedication\");\n        let sanctum = (actor.getRollOptions(['all'])).some(x=>x === \"self:feat:soul-sanctum\");\n        \n        let mastery = (actor.getRollOptions(['all'])).some(x=>x === \"self:feature:soul-mastery\");\n        \n        if(mastery) cap++;\n        \n        if(dedication) cap = 2;\n        \n        if(sanctum) cap = wis;\n        \n        \n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let shards = existing.data.data.level.value;\n            \n\n            if(shards+1 > cap){\n                ui.notifications.warn(\"You're already at maximum Soul Shard capacity!\");\n                return;\n            }\n            \n            await existing.delete();\n            \n            source.data.level.value = shards+1;\n            source.img = `modules/vyk-homebrew/assets/reaper/${Math.min(10,shards+1)}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            \n            source.img = `modules/vyk-homebrew/assets/reaper/1.png`;\n            source.data.level.value = 1;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.BgstaNrT1d3mqtbP"}}}
{"name":"Corruption Saving Throw","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"icons/magic/unholy/hand-claw-glow-orange.webp","scope":"global","command":"if (!actor) {\n    ui.notifications.warn(\"You must have an actor selected\");\n} else {\n    const skillName = \"Craft\";\n    const skillKey = \"cra\";\n    const actionSlug = \"overdrive\"\n    const actionName = \"Overdrive Check\"\n    \n    const modifiers = []\n    // list custom modifiers for a single roll here\n    //const modifiers = [\n    //new game.pf2e.Modifier('Expanded Healer\\'s Tools', 1, 'item')\n    //];\n    const level = actor.data.data.details.level.value;\n    console.log(level);\n    \n    const DC = 14 + level + Math.floor(level/3);\n    \n    console.log(DC);\n    \n    const notes = [{\"outcome\":[\"success\"], \"selector\":\"will\", \"text\":'<p><b>Success</b> Reduce your Corruption by 1.</p>'}, {\"outcome\":[\"criticalSuccess\"], \"selector\":\"will\", \"text\":'<p><b>Success</b> Reduce your Corruption by 2.</p>'}]; // add more notes if necessary\n    \n    const options = token.actor.getRollOptions(['all', 'saving-throw', \n    'will']);\n    \n    options.push(`action:${actionSlug}`); \n    \n    game.pf2e.Check.roll(\n    new game.pf2e.CheckModifier(\n        `<b>Corruption Save</b> - <p class=\"compact-text\">Will saving throw</p>`,\n        actor.data.document.saves.will.data, modifiers ),\n        { actor: actor, type: 'saving-throw', options, notes, dc: {value: DC}},\n        event\n        // for callback: ,(Roll) => {console.log(Roll);}\n        \n    );\n    \n}","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.A8OXRj7ksEftIUVQ"}},"_id":"G05s7m6rhLBkRwKA"}
{"_id":"QCTSZJ2TiXcF1DfM","name":"Fiend Damage","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"icons/magic/unholy/hand-claw-fire-blue.webp","scope":"global","command":"const types = {\n    1:\"negative\",\n    2:\"positive\",\n    3:\"chaotic\",\n    4:\"lawful\",\n    5:\"evil\",\n    6:\"fire\",\n    7:\"electricity\",\n    8:\"acid\",\n    9:\"cold\",\n    10:\"mental\",\n    11:\"slashing\"\n}\n\nlet dieSize = {\n    0:4,\n    1:6,\n    2:8,\n    3:10,\n    4:12\n}\nif (!actor) {\n    ui.notifications.warn(\"You must have an actor selected\");\n} else {\n    \n    let dmgType = actor.data.data.custom.modifiers.fiendishDamage;\n    \n    let options = actor.getRollOptions(['all']);\n    \n    console.log(options);\n    \n    let ded1 = options.some(f=>f ===`feat:reaper-dedication`);\n    let ded2 = options.some(f=>f ===`feat:fiendish-power`);\n    let ded3 = options.some(f=>f ===`feat:greater-fiendish-power`);\n    \n    \n    let feat = options.some(f=>f ===`feat:grim-reaper`);\n    \n    let lv = actor.data.data.details.level.value;\n    \n    let dice = ded1? ( ded3?2:1) :(2 + Math.floor((lv-1)/4));\n\n    let size = ded1? (ded2 ? 1:0) : 1;\n    \n    if(feat) size++;\n    \n    let roll = new Roll(`${dice}d${dieSize[size]}[${types[dmgType]}]`);\n    \n    roll.toMessage({flavor:`Avatar Damage - ${types[dmgType]}`});\n}","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.uqcKYYMvsUP6lCDG"}}}
{"_id":"mofcCtrNluwD83W9","name":"Substract Shard","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"modules/vyk-homebrew/assets/reaper/substract.png","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.reaper.I0dHV996KYyVFt6E\";\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n\n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let shards = existing.data.data.level.value;\n            \n            await existing.delete();\n           \n           if(shards-1 === 0) return;\n           \n            source.data.level.value = shards-1;\n            source.img = `modules/vyk-homebrew/assets/reaper/${Math.min(10,shards-1)}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            ui.notifications.warn(\"You do not have any Soul Shards left!\");\n            return;\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.2vYeNq5TtEZNT6mf"}}}
{"_id":"xqQj29oHFik9ydvp","name":"Asclepius","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"icons/magic/unholy/orb-glowing-yellow-purple.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.reaper.REtsIwch3iOqNtMf\";\n\n(async () => {\n    \n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    }else{\n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        let lv = actor.data.data.details.level.value;\n        \n        let cap = 3 * Math.ceil(lv/2);\n        \n        let gain = 2 * Math.ceil(lv/2);\n        \n        let current = actor.data.data.attributes.hp.temp;\n        \n        if(existing){\n            await actor.update({\"data.attributes.hp.temp\": Math.min(cap, current+gain) });\n        } else{\n            source.data.level.value = Math.ceil(lv/2);\n            await actor.update({\"data.attributes.hp.temp\": cap });\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.EXcZ7QpZStUkOjXL"}}}
{"name":"Grant Fiendish Smite","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"icons/magic/unholy/strike-beam-blood-large-red-purple.webp","scope":"global","command":"const types = {\n    1:\"negative\",\n    2:\"positive\",\n    3:\"chaotic\",\n    4:\"lawful\",\n    5:\"evil\",\n    6:\"fire\",\n    7:\"electricity\",\n    8:\"acid\",\n    9:\"cold\",\n    10:\"mental\",\n    11:\"slashing\"\n}\nconst UUID = \"Compendium.vyk-homebrew.reaper.BvZRfyx6jYYKhOZz\";\n\nasync function apply($HTML,$OVERRIDE,$ACTOR){\n    let ID = $HTML.find(`[name=\"weapon\"]`)[0].value;\n    \n    const weapon = $ACTOR.items.find(i=> i.id === ID);\n    \n    console.log(weapon);\n    \n    let source = (await fromUuid(UUID)).toObject();\n    source.flags.core ?? {};\n    source.flags.core.sourceId = UUID;\n    \n    const existing = $ACTOR.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n    if(existing){\n        await existing.delete();\n    }else{\n        ui.notifications.info(\"Effect added to Actor!\");\n        \n        let dmgType = $OVERRIDE? \"evil\":types[$ACTOR.data.data.custom.modifiers.fiendishDamage];\n        \n        let options = $ACTOR.getRollOptions(['all', 'damage-roll','melee']);\n        \n        let dmg = weapon.data.data.damage.dice + weapon.data.data.runes.striking;\n        \n        source.data.rules.push({\n            \"key\": \"FlatModifier\",\n            \"selector\":\"damage\",\n            \"label\":\"Fiendish Smite\",\n            \"damageType\":`${dmgType}`,\n            \"predicate\":{\n                \"all\":[\"trip\",\"fiendishSmite\"]\n            },\n            \"value\": dmg\n        });\n        \n        if(options.some(x=>x === \"self:feat:power-attack\")){\n            source.data.rules.push({\n                \"key\": \"FlatModifier\",\n                \"selector\":\"damage\",\n                \"label\":\"Fiendish Smite (Power Attack)\",\n                \"damageType\":`${dmgType}`,\n                \"predicate\":{\n                    \"all\":[\"trip\",\"fiendishSmite\",\"power-attack\"]\n                },\n                \"value\":{\n                    \"brackets\":[\n                        {\n                            \"end\":9,\n                            \"value\":1\n                            \n                        },{\n                            \"end\":17,\n                            \"start\":10,\n                            \"value\":2\n                            \n                        },{\n                            \"start\":18,\n                            \"value\":3\n                            \n                        }\n                    ]\n                }\n            });\n        }\n        \n        await $ACTOR.createEmbeddedDocuments('Item', [source]);\n    }\n    \n}\n\nif(!actor){\n    ui.notifications.warn(\"You must have an actor selected\");\n    return;\n}else{\n    const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n    \n    if(existing){\n        existing.delete();\n        return;\n    }\n    let weapons = actor.items.filter(i=> i.type === \"weapon\" && i.isEquipped && i.traits.has(\"trip\"));\n    \n    console.log(weapons);\n    \n    if(weapons.length === 0){\n        ui.notifications.warn(\"You lack a Reaper's Weapon!\");\n        return;\n    }\n    \n    let weaponString = ``;\n    \n    for(let weapon of weapons){\n        weaponString = weaponString.concat(`<option value=\"${weapon.id}\">${weapon.name}</option>`)\n    }\n    \n    new Dialog({\n        title:`Fiendish Smite`,\n        content:`\n        <form>\n            <div class='form-group'>\n                <label>Choose your Weapon:</label>\n                <select id=\"weapon\" name=\"weapon\">\n                    ${weaponString}\n                </select>\n            </div>\n        </form>`,\n        buttons:{\n            confirm1:{\n                label:`Default Fiend Damage`,\n                callback: async (html) => await apply(html, false, actor)\n            },\n            confirm2:{\n                label:`Evil Damage`,\n                callback: async (html) => await apply(html, true, actor)\n            },\n            cancel:{\n                icon: `<i class=\"fas fa-times\"></i>`,\n                label: 'Cancel'\n            }\n            \n        }\n    }).render(true);\n}","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.HGv5RW4B7T7A1zw1"}},"_id":"yu84GwUcG0qIsIbX"}
{"_id":"EJsdlWNQ20ltHwOQ","name":"Add Shard","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"modules/vyk-homebrew/assets/reaper/add.png","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.reaper.I0dHV996KYyVFt6E\";\n\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let wis = actor.system.abilities.wis.mod;\n        \n        let cap = 1 + wis;\n        \n        let dedication = (actor.getRollOptions(['all'])).some(x=>x === \"self:feat:reaper-dedication\");\n        let sanctum = (actor.getRollOptions(['all'])).some(x=>x === \"self:feat:soul-sanctum\");\n        \n        let mastery = (actor.getRollOptions(['all'])).some(x=>x === \"self:feature:soul-mastery\");\n        \n        if(mastery) cap++;\n        \n        if(dedication) cap = 2;\n        \n        if(sanctum) cap = wis;\n        \n        \n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let shards = existing.system.level.value;\n            \n\n            if(shards+1 > cap){\n                ui.notifications.warn(\"You're already at maximum Soul Shard capacity!\");\n                return;\n            }\n            \n            await existing.delete();\n            \n            source.system.level.value = shards+1;\n            source.img = `modules/vyk-homebrew/assets/reaper/${Math.min(10,shards+1)}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            \n            source.img = `modules/vyk-homebrew/assets/reaper/1.png`;\n            source.system.level.value = 1;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n        }\n    }\n})();","folder":null,"sort":0,"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.BgstaNrT1d3mqtbP"}},"ownership":{"default":0,"MIb5Ldg8TLeVngZ1":3},"_stats":{"systemId":"pf2e","systemVersion":"4.1.3","coreVersion":"10.286","createdTime":null,"modifiedTime":1664396821756,"lastModifiedBy":"KPVkkpR21c13yy2y"}}
{"_id":"mofcCtrNluwD83W9","name":"Substract Shard","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"modules/vyk-homebrew/assets/reaper/substract.png","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.reaper.I0dHV996KYyVFt6E\";\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n\n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let shards = existing.system.level.value;\n            \n            await existing.delete();\n           \n           if(shards-1 === 0) return;\n           \n            source.system.level.value = shards-1;\n            source.img = `modules/vyk-homebrew/assets/reaper/${Math.min(10,shards-1)}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            ui.notifications.warn(\"You do not have any Soul Shards left!\");\n            return;\n        }\n    }\n})();","folder":null,"sort":0,"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.2vYeNq5TtEZNT6mf"}},"ownership":{"default":0,"MIb5Ldg8TLeVngZ1":3},"_stats":{"systemId":"pf2e","systemVersion":"4.1.3","coreVersion":"10.286","createdTime":null,"modifiedTime":1664396853645,"lastModifiedBy":"KPVkkpR21c13yy2y"}}
{"_id":"xqQj29oHFik9ydvp","name":"Asclepius","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"icons/magic/unholy/orb-glowing-yellow-purple.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.reaper.REtsIwch3iOqNtMf\";\n\n(async () => {\n    \n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    }else{\n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        let lv = actor.level;\n        \n        let cap = 3 * Math.ceil(lv/2);\n        \n        let gain = 2 * Math.ceil(lv/2);\n        \n        let current = actor.system.attributes.hp.temp;\n        \n        if(existing){\n            await actor.update({\"system.attributes.hp.temp\": Math.min(cap, current+gain) });\n        } else{\n            source.system.level.value = Math.ceil(lv/2);\n            await actor.update({\"system.attributes.hp.temp\": cap });\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n        }\n    }\n})();","folder":null,"sort":0,"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.EXcZ7QpZStUkOjXL"}},"ownership":{"default":0,"MIb5Ldg8TLeVngZ1":3},"_stats":{"systemId":"pf2e","systemVersion":"4.1.3","coreVersion":"10.286","createdTime":null,"modifiedTime":1664396907240,"lastModifiedBy":"KPVkkpR21c13yy2y"}}
{"_id":"07JEnzafmxZn0Mtd","name":"Baleful Gouge","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"icons/magic/unholy/hand-claw-fire-blue.webp","scope":"global","command":"let dieSize = {\n    0:4,\n    1:6,\n    2:8,\n    3:10,\n    4:12\n}\n\nif (!actor) {\n    ui.notifications.warn(\"You must have an actor selected\");\n} else {\n    let options = actor.getRollOptions(['all']);\n    \n    let dmgType = actor.flags.pf2e?.reaper?.fiendishDamage ?? \"evil\";\n    \n    let feat = options.some(f=>f ===`feat:grim-reaper`);\n    \n    let lv = actor.level;\n    \n    let dice = 2 + Math.floor((lv-1)/4);\n    \n    let size = 2;\n    \n    if(feat) size++;\n    \n    let roll = new Roll(`${dice}d${dieSize[size]}[evil]`);\n    \n    roll.toMessage({flavor:\"Baleful Gouge Damage - Evil\"});\n}","folder":null,"sort":0,"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.uqcKYYMvsUP6lCDG"}},"ownership":{"default":0,"MIb5Ldg8TLeVngZ1":3},"_stats":{"systemId":"pf2e","systemVersion":"4.1.3","coreVersion":"10.286","createdTime":null,"modifiedTime":1664397029577,"lastModifiedBy":"KPVkkpR21c13yy2y"}}
{"_id":"QCTSZJ2TiXcF1DfM","name":"Fiend Damage","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"icons/magic/unholy/hand-claw-fire-blue.webp","scope":"global","command":"const types = {\n    1:\"negative\",\n    2:\"positive\",\n    3:\"chaotic\",\n    4:\"lawful\",\n    5:\"evil\",\n    6:\"fire\",\n    7:\"electricity\",\n    8:\"acid\",\n    9:\"cold\",\n    10:\"mental\",\n    11:\"slashing\"\n}\n\nlet dieSize = {\n    0:4,\n    1:6,\n    2:8,\n    3:10,\n    4:12\n}\nif (!actor) {\n    ui.notifications.warn(\"You must have an actor selected\");\n} else {\n    \n    let dmgType = actor.flags.pf2e?.reaper?.fiendishDamage || \"evil\";\n    \n    let options = actor.getRollOptions(['all']);\n    \n    console.log(options);\n    \n    let ded1 = options.some(f=>f ===`feat:reaper-dedication`);\n    let ded2 = options.some(f=>f ===`feat:fiendish-power`);\n    let ded3 = options.some(f=>f ===`feat:greater-fiendish-power`);\n    \n    \n    let feat = options.some(f=>f ===`feat:grim-reaper`);\n    \n    let lv = actor.level;\n    \n    let dice = ded1? ( ded3?2:1) :(2 + Math.floor((lv-1)/4));\n\n    let size = ded1? (ded2 ? 1:0) : 1;\n    \n    if(feat) size++;\n    \n    let roll = new Roll(`${dice}d${dieSize[size]}[${types[dmgType]}]`);\n    \n    roll.toMessage({flavor:`Avatar Damage - ${types[dmgType]}`});\n}","folder":null,"sort":0,"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.uqcKYYMvsUP6lCDG"}},"ownership":{"default":0,"MIb5Ldg8TLeVngZ1":3},"_stats":{"systemId":"pf2e","systemVersion":"4.1.3","coreVersion":"10.286","createdTime":null,"modifiedTime":1664397224465,"lastModifiedBy":"KPVkkpR21c13yy2y"}}
{"_id":"07JEnzafmxZn0Mtd","name":"Baleful Gouge","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"icons/magic/unholy/hand-claw-fire-blue.webp","scope":"global","command":"let dieSize = {\n    0:4,\n    1:6,\n    2:8,\n    3:10,\n    4:12\n}\n\nif (!actor) {\n    ui.notifications.warn(\"You must have an actor selected\");\n} else {\n    let options = actor.getRollOptions(['all']);\n    \n    let feat = options.some(f=>f ===`feat:grim-reaper`);\n    \n    let lv = actor.level;\n    \n    let dice = 2 + Math.floor((lv-1)/4);\n    \n    let size = 2;\n    \n    if(feat) size++;\n    \n    let roll = new Roll(`${dice}d${dieSize[size]}[evil]`);\n    \n    roll.toMessage({flavor:\"Baleful Gouge Damage - Evil\"});\n}","folder":null,"sort":0,"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.uqcKYYMvsUP6lCDG"}},"ownership":{"default":0,"MIb5Ldg8TLeVngZ1":3},"_stats":{"systemId":"pf2e","systemVersion":"4.1.3","coreVersion":"10.286","createdTime":null,"modifiedTime":1664397225195,"lastModifiedBy":"KPVkkpR21c13yy2y"}}
{"name":"Grant Fiendish Smite","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"icons/magic/unholy/strike-beam-blood-large-red-purple.webp","scope":"global","command":"const types = {\n    1:\"negative\",\n    2:\"positive\",\n    3:\"chaotic\",\n    4:\"lawful\",\n    5:\"evil\",\n    6:\"fire\",\n    7:\"electricity\",\n    8:\"acid\",\n    9:\"cold\",\n    10:\"mental\",\n    11:\"slashing\"\n}\nconst UUID = \"Compendium.vyk-homebrew.reaper.BvZRfyx6jYYKhOZz\";\n\nasync function apply($HTML,$OVERRIDE,$ACTOR){\n    let ID = $HTML.find(`[name=\"weapon\"]`)[0].value;\n    \n    const weapon = $ACTOR.items.find(i=> i.id === ID);\n    \n    console.log(weapon);\n    \n    let source = (await fromUuid(UUID)).toObject();\n    source.flags.core ?? {};\n    source.flags.core.sourceId = UUID;\n    \n    const existing = $ACTOR.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n    if(existing){\n        await existing.delete();\n    }else{\n        ui.notifications.info(\"Effect added to Actor!\");\n        \n        let dmgType = $OVERRIDE? \"evil\":types[$ACTOR.flags.pf2e?.reaper?.fiendishDamage ?? \"evil\"];\n        \n        let options = $ACTOR.getRollOptions(['all', 'damage-roll','melee']);\n        \n        let dmg = weapon.system.damage.dice + weapon.system.runes.striking;\n        \n        source.system.rules.push({\n            \"key\": \"FlatModifier\",\n            \"selector\":\"damage\",\n            \"label\":\"Fiendish Smite\",\n            \"damageType\":`${dmgType}`,\n            \"predicate\":{\n                \"all\":[\"trip\",\"fiendishSmite\"]\n            },\n            \"value\": dmg\n        });\n        \n        if(options.some(x=>x === \"self:feat:power-attack\")){\n            source.system.rules.push({\n                \"key\": \"FlatModifier\",\n                \"selector\":\"damage\",\n                \"label\":\"Fiendish Smite (Power Attack)\",\n                \"damageType\":`${dmgType}`,\n                \"predicate\":{\n                    \"all\":[\"trip\",\"fiendishSmite\",\"power-attack\"]\n                },\n                \"value\":{\n                    \"brackets\":[\n                        {\n                            \"end\":9,\n                            \"value\":1\n                            \n                        },{\n                            \"end\":17,\n                            \"start\":10,\n                            \"value\":2\n                            \n                        },{\n                            \"start\":18,\n                            \"value\":3\n                            \n                        }\n                    ]\n                }\n            });\n        }\n        \n        await $ACTOR.createEmbeddedDocuments('Item', [source]);\n    }\n    \n}\n\nif(!actor){\n    ui.notifications.warn(\"You must have an actor selected\");\n    return;\n}else{\n    const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n    \n    if(existing){\n        existing.delete();\n        return;\n    }\n    let weapons = actor.items.filter(i=> i.type === \"weapon\" && i.isEquipped && i.traits.has(\"trip\"));\n    \n    console.log(weapons);\n    \n    if(weapons.length === 0){\n        ui.notifications.warn(\"You lack a Reaper's Weapon!\");\n        return;\n    }\n    \n    let weaponString = ``;\n    \n    for(let weapon of weapons){\n        weaponString = weaponString.concat(`<option value=\"${weapon.id}\">${weapon.name}</option>`)\n    }\n    \n    new Dialog({\n        title:`Fiendish Smite`,\n        content:`\n        <form>\n            <div class='form-group'>\n                <label>Choose your Weapon:</label>\n                <select id=\"weapon\" name=\"weapon\">\n                    ${weaponString}\n                </select>\n            </div>\n        </form>`,\n        buttons:{\n            confirm1:{\n                label:`Default Fiend Damage`,\n                callback: async (html) => await apply(html, false, actor)\n            },\n            confirm2:{\n                label:`Evil Damage`,\n                callback: async (html) => await apply(html, true, actor)\n            },\n            cancel:{\n                icon: `<i class=\"fas fa-times\"></i>`,\n                label: 'Cancel'\n            }\n            \n        }\n    }).render(true);\n}","folder":null,"sort":0,"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.HGv5RW4B7T7A1zw1"}},"_id":"yu84GwUcG0qIsIbX","ownership":{"default":0,"MIb5Ldg8TLeVngZ1":3},"_stats":{"systemId":"pf2e","systemVersion":"4.1.3","coreVersion":"10.286","createdTime":null,"modifiedTime":1664397346602,"lastModifiedBy":"KPVkkpR21c13yy2y"}}
