{"name":"Infuse","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"icons/magic/symbols/runes-star-pentagon-blue.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.gunbreaker.e3Ow7r6E1jJnEEg7\";\nconst FUUID = \"Compendium.vyk-homebrew.gunbreaker.ZgnjG1UXTvO2SQpA\";\n\n\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let int = actor.data.data.abilities.int.mod;\n        let cha = actor.data.data.abilities.cha.mod;\n        let lv = actor.data.data.details.level.value;\n        \n        \n        let cap = Math.ceil(lv/2) + actor.data.data.custom.modifiers.gunbreakerMod>1?cha:int;\n        \n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            await existing.delete();\n        } else{\n            \n            source.img = `modules/vyk-homebrew/assets/gunbreaker/${cap}.png`;\n            source.data.level.value = cap;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.LnDs8H5QRonbqqq3"}},"_id":"LaqCoyquSSqqvoAg"}
{"name":"Gain Cartridge","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"modules/vyk-homebrew/assets/gunbreaker/add.png","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.gunbreaker.e3Ow7r6E1jJnEEg7\";\n\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let int = actor.data.data.abilities.int.mod;\n        let cha = actor.data.data.abilities.cha.mod;\n        let lv = actor.data.data.details.level.value;\n        \n        \n        let cap = Math.ceil(lv/2) + actor.data.data.custom.modifiers.gunbreakerMod>1?cha:int;\n        \n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let cartridges = existing.data.data.level.value;\n            \n\n            if(cartridges+1 > cap){\n                ui.notifications.warn(\"You're already at maximum Charged Cartridge capacity!\");\n                return;\n            }\n            \n            await existing.delete();\n            \n            source.data.level.value = cartridges+1;\n            source.img = `modules/vyk-homebrew/assets/gunbreaker/${Math.min(19,cartridges+1)}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            \n            source.img = `modules/vyk-homebrew/assets/gunbreaker/1.png`;\n            source.data.level.value = 1;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.AfOd0aatJJBtY5Ge"}},"_id":"MK8SC8XMD3B8JLkw"}
{"name":"Substract Cartridge","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"modules/vyk-homebrew/assets/gunbreaker/substract.png","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.gunbreaker.e3Ow7r6E1jJnEEg7\";\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        \n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let cartridges = existing.data.data.level.value;\n            \n            await existing.delete();\n\n            if(cartridges-1 === 0) return;\n            \n            source.data.level.value = cartridges-1;\n            source.img = `modules/vyk-homebrew/assets/gunbreaker/${Math.min(19,cartridges-1)}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            ui.notifications.warn(\"You do not have any Charged Cartridges left!\");\n            return;\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.Jbyjo3N8jn9D7k1a"}},"_id":"T3U9D8mFZzeRBMn7"}
{"_id":"LaqCoyquSSqqvoAg","name":"Infuse","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"icons/magic/symbols/runes-star-pentagon-blue.webp","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.gunbreaker.e3Ow7r6E1jJnEEg7\";\nconst FUUID = \"Compendium.vyk-homebrew.gunbreaker.ZgnjG1UXTvO2SQpA\";\n\n\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let int = actor.data.data.abilities.int.mod;\n        let cha = actor.data.data.abilities.cha.mod;\n        let lv = actor.data.data.details.level.value;\n        \n        let mod = actor.data.data.custom.modifiers.gunbreakerMod>1?cha:int;\n        \n        let cap = Math.ceil(lv/2) + mod;\n        \n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            await existing.delete();\n        } else{\n            \n            source.img = `modules/vyk-homebrew/assets/gunbreaker/${cap}.png`;\n            source.data.level.value = cap;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.LnDs8H5QRonbqqq3"}}}
{"_id":"MK8SC8XMD3B8JLkw","name":"Gain Cartridge","type":"script","author":"MIb5Ldg8TLeVngZ1","img":"modules/vyk-homebrew/assets/gunbreaker/add.png","scope":"global","command":"const UUID = \"Compendium.vyk-homebrew.gunbreaker.e3Ow7r6E1jJnEEg7\";\n\n\n(async () =>{\n    if(!actor){\n        ui.notifications.warn(\"You must have an actor selected\");\n        return;\n    } else{\n        let int = actor.data.data.abilities.int.mod;\n        let cha = actor.data.data.abilities.cha.mod;\n        let lv = actor.data.data.details.level.value;\n        let mod = actor.data.data.custom.modifiers.gunbreakerMod>1?cha:int;\n        \n        let cap = Math.ceil(lv/2) + mod;\n        \n        let source = (await fromUuid(UUID)).toObject();\n        source.flags.core ?? {};\n        source.flags.core.sourceId = UUID;\n        \n        console.log(source);\n        \n        const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === UUID);\n        \n        if(existing){\n            \n            console.log(existing);\n            \n            let cartridges = existing.data.data.level.value;\n            \n\n            if(cartridges+1 > cap){\n                ui.notifications.warn(\"You're already at maximum Charged Cartridge capacity!\");\n                return;\n            }\n            \n            await existing.delete();\n            \n            source.data.level.value = cartridges+1;\n            source.img = `modules/vyk-homebrew/assets/gunbreaker/${Math.min(19,cartridges+1)}.png`;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n            \n        } else{\n            \n            source.img = `modules/vyk-homebrew/assets/gunbreaker/1.png`;\n            source.data.level.value = 1;\n            \n            await actor.createEmbeddedDocuments('Item', [source]);\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"MIb5Ldg8TLeVngZ1":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.AfOd0aatJJBtY5Ge"}}}
